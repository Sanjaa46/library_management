{"version":3,"file":"BookInfo-DOV8MalB.js","sources":["../../../../frontend/src/assets/components/Reviews.vue","../../../../frontend/src/pages/BookInfo.vue"],"sourcesContent":["<template>\n\n<article class=\"w-full h-[70%] bg-black-overlay-30 rounded-[20px] mx-5 shadow-xl\">\n    <div class=\"flex p-3\">\n        <img src=\"../images/profile.png\" alt=\"\">\n        <h1 class=\"my-auto ml-3\">{{ review.library_member }}</h1>\n    </div>\n    <rate :length=\"5\" v-model=\"review.rating\" :disabled=\"true\" :readonly=\"true\" class=\"\" />\n    <p class=\"w-full h-[20px] p-1\">{{ review.review }}</p>\n</article>\n\n</template>\n\n<script setup>\nimport { ref, onMounted, defineProps } from 'vue';\n\ndefineProps({\n  review: {\n    type: Object,\n    required: true\n  }\n});\n\n</script>","<template>\n    <Header></Header>\n    <div class=\"\">\n        <div class=\"w-[1120px] my-8 mx-auto text-[24px] font-bold relative\">\n            <div class=\"absolute w-1 h-12 bg-[#118ab2] left-0\"></div>\n            <h1 class=\"text-4xl font-bold pl-5 pt-2\">Book Info</h1>\n        </div>\n\n        <section  class=\"flex w-[1120px] p-[30px] mx-auto my-10\">\n            <!-- Book image and Author -->\n            <div class=\"flex flex-col w-[20%] items-center justify-center\">\n                <img :src=\"book.image\" class=\"w-[200px] h-[300px] object-contain rounded-[5px]\" alt=\"book image\">\n                <p class=\"text-center mt-5\">{{ book.author }}</p>\n                <rate :length=\"5\" v-model=\"articleRating\" :disabled=\"true\" :readonly=\"true\" :showcount=\"true\" class=\"color-black text-center  opacity-[100%]\" />\n            </div>\n\n            <!-- Book information -->\n            <div class=\"w-[80%] ml-10\">\n                <h1 class=\"text-[25px] font-medium\">{{ book.article_name }}</h1>\n                <div class=\"flex my-5 space-x-5 text-[15px]\">\n                    <p><b>Author: </b>{{ book.author }}</p>\n                    <p><b>Publisher: </b>{{ book.publisher }}</p>\n                    <p><b>ISBN: </b>{{ book.isbn }}</p>\n                    <p><b>Status: </b>{{ book.status }}</p>\n                </div>\n                <h1 class=\"text-[18px] font-medium\">Description</h1>\n                <p>\n                    {{ book.description }}\n                </p>\n                <Button \n                v-if=\"!issueSuccess\"\n                @click=\"issueBook\" \n                variant=\"solid\" \n                :class='[\"bg-[#1290b9] w-[90px] text-white my-10 rounded hover:bg-[#016475] transition\", issueButtonClasses]'\n                >\n                Issue\n                </Button>\n                <!-- Write review -->\n                <Button \n                @click=\"writeReview\" \n                variant=\"solid\" \n                class=\"bg-[#1290b9] text-white my-10 mx-5 rounded hover:bg-[#016475] transition\"\n                >\n                Write Review\n                </Button>\n            </div>\n        </section>\n    </div>\n    <section class=\"w-[1120px] h-[250px] flex m-auto\">\n        <Reviews v-if=\"reviews.length > 0\" v-for=\"review in reviews\" :review=\"review\"/>\n    </section>\n        \n    <Footer></Footer>\n        \n    <div v-if=\"popup\" class=\"absolute w-screen top-0 h-full bg-black-overlay-300\">\n        <div class=\"flex w-full h-full justify-center items-center\">\n            <Card title=\"Write Review!\" class=\"w-[50%]  bg-[#f7f4f0] z-10 px-12 py-10 rounded-xl shadow-lg\">\n                <h2 class=\"text-xl font-medium text-center mb-8\">Write Review</h2>\n                <form class=\"flex flex-col space-y-5 w-full \" @submit.prevent=\"\">\n                    <rate :length=\"5\" v-model=\"customerRating\" :showcount=\"true\" class=\"text-center\" />\n                    <textarea\n                        required\n                        v-model=\"customerReview\"\n                        name=\"review\"\n                        placeholder=\"Review...\"\n                        class=\"h-[200px]\"\n                    ></textarea>\n                    <div class=\"w-full space-x-5 m-auto \">\n                        <Button variant=\"solid\" @click=\"sendReview\" class=\"bg-[#007C91] w-[45%] m-auto text-white py-2 rounded hover:bg-[#006273] transition\">\n                            Write Review\n                        </Button>\n                        <Button @click=\"cancelWriteReview\" variant=\"solid\" class=\"bg-[#007C91] w-[45%] m-auto text-white py-2 rounded hover:bg-[#006273] transition\">\n                            Cancel\n                        </Button>\n                    </div>\n                </form>\n            </Card>\n      </div>\n    </div>\n</template>\n\n\n<script setup>\nimport Header from '../assets/components/Header.vue';\nimport Footer from '../assets/components/Footer.vue';\nimport { inject, defineProps, ref, onMounted, computed, watch } from 'vue';\nimport { useRoute } from 'vue-router';\nimport Reviews from '../assets/components/Reviews.vue';\n\n\nconst route = useRoute();\n\nconst book = ref({})\nconst articleName = ref(\"\")\nconst issueSuccess = ref(false)\nconst articleRating = ref(0)\nconst reviews = ref([])\nconst popup = ref(false)\n\n// Variables for write review popup\nconst customerReview = ref(\"\");\nconst customerRating = ref(0)\n\nonMounted(async () => {\n    articleName.value = route.query.article_name;\n    const socket = inject('socket')\n\n    const url = `/api/method/library_management.api.book_info?article_name=${articleName.value}`\n\n    // Fetch book info\n    try {\n        const response = await fetch(url, {\n            credentials: 'include',\n            method: 'POST',\n            body: {\n                article_name: articleName.value\n            }\n        });\n        const data = await response.json()\n\n        book.value = data.message\n        articleRating.value = parseInt(data.message.rating)\n    }\n    catch (error) {\n        console.error(\"Failed to fetch books: \", error);\n    }\n\n    // Check user have an active issue\n    try {\n        const check_issue_url = `/api/method/library_management.api.has_active_issue?book=${articleName.value}`\n        \n        const response = await fetch(check_issue_url, {\n            credentials: 'include'\n        })\n        const check_issue_data = await response.json();\n        issueSuccess.value = check_issue_data.message\n    } catch(error) {\n        console.error(\"Failed to check the user have an active issue: \", error)\n    }\n\n    await fetchBookReviews()\n    \n    socket.on('new_review', (data) => {\n        if (data.book === articleName.value) {\n            reviews.value.unshift({\n                library_member: data.library_member,\n                rating: data.rating,\n                review: data.review,\n                name: data.name\n            });\n        }\n    });\n})\n\nconst issueButtonClasses = computed(() => {\n    return issueSuccess.value\n        ? \"opacity-0 cursor-not-allowed\"\n        : \"opacity-100\"\n})\n\nasync function issueBook() {\n\n    const url = `/api/method/library_management.api.issue_book?book=${articleName.value}`\n    \n    try {\n        const response = await fetch(url, {\n            credentials: 'include'\n        })\n        const data = await response.json();\n        if (!data.message.success) {\n            alert(\"You already requested this book!\")\n        }\n    } catch(error) {\n        console.error(\"Failed to issue the book: \", error)\n        issueSuccess.value = false;\n    }\n}\n\nfunction writeReview() {\n    popup.value = !popup.value\n}\n\nfunction cancelWriteReview() {\n    popup.value = !popup.value;\n    customerRating.value = 0;\n    customerReview.value = \"\";\n}\n\nasync function sendReview() {\n    \n    try {\n        const url = `/api/method/library_management.api.write_review?book=${articleName.value}&rating=${customerRating.value}&review=${customerReview.value}`\n\n        const response = await fetch(url, {\n            credentials: 'include',\n            method: 'POST'\n        })\n\n        const data = await response.json();\n\n        if(data.message.success) {\n            popup.value = !popup.value\n        } else {\n            alert(data.message.message)\n            popup.value = !popup.value\n        }\n    } catch(error) {\n        console.error(\"Failed to write review. \", error)\n        alert(\"Failed to write review!\")\n        popup.value = !popup.value\n    }\n}\n\nasync function fetchBookReviews() {\n // Get reviews\n    try {\n        const url = `/api/method/library_management.api.get_reviews?book=${articleName.value}`\n\n        const response = await fetch(url, {\n            credentials: 'include',\n            method: 'POST'\n        })\n        const data = await response.json();\n\n        reviews.value = data.message;\n    } catch(error) {\n        console.error(\"Failed to fetch book reviews: \", error)\n    }\n}\n\n</script>"],"names":["_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_imports_0","_hoisted_3","_toDisplayString","__props","_createVNode","_component_rate","_cache","$event","_hoisted_4","route","useRoute","book","ref","articleName","issueSuccess","articleRating","reviews","popup","customerReview","customerRating","onMounted","__async","socket","inject","url","data","error","check_issue_url","check_issue_data","fetchBookReviews","issueButtonClasses","computed","issueBook","writeReview","cancelWriteReview","sendReview","Header","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_createTextVNode","_createBlock","_component_Button","_hoisted_9","_Fragment","_renderList","review","Reviews","Footer","_hoisted_10","_hoisted_11","_component_Card","_hoisted_12"],"mappings":"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"}
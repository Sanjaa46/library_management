var _=(p,y,s)=>new Promise((r,i)=>{var b=o=>{try{a(s.next(o))}catch(d){i(d)}},h=o=>{try{a(s.throw(o))}catch(d){i(d)}},a=o=>o.done?r(o.value):Promise.resolve(o.value).then(b,h);a((s=s.apply(p,y)).next())});import{B as k,l as C,m as x,n as t,q as u,L as c,J as T,r as v,a as W,c as D,M as R,y as V,G as m,v as g,N as M,F as $,x as O,C as P,D as U,E as z}from"./index-Xv_YIibc.js";import{b as E,_ as L,a as A}from"./Footer-57EP99_Z.js";const G={class:"w-full h-[70%] bg-black-overlay-30 rounded-[20px] mx-5 shadow-xl"},J={class:"flex p-3"},Y={class:"my-auto ml-3"},H={class:"w-full h-[20px] p-1"},K={__name:"Reviews",props:{review:{type:Object,required:!0}},setup(p){return(y,s)=>{const r=k("rate");return x(),C("article",G,[t("div",J,[s[1]||(s[1]=t("img",{src:E,alt:""},null,-1)),t("h1",Y,c(p.review.library_member),1)]),u(r,{length:5,modelValue:p.review.rating,"onUpdate:modelValue":s[0]||(s[0]=i=>p.review.rating=i),disabled:!0,readonly:!0,class:""},null,8,["modelValue"]),t("p",H,c(p.review.review),1)])}}},Q={class:""},X={class:"flex w-[1120px] p-[30px] mx-auto my-10"},Z={class:"flex flex-col w-[20%] items-center justify-center"},ee=["src"],te={class:"text-center mt-5"},se={class:"w-[80%] ml-10"},ae={class:"text-[25px] font-medium"},oe={class:"flex my-5 space-x-5 text-[15px]"},le={class:"w-[1120px] h-[250px] flex m-auto"},ne={key:0,class:"absolute w-screen top-0 h-full bg-black-overlay-300"},re={class:"flex w-full h-full justify-center items-center"},ie={class:"w-full space-x-5 m-auto"},ve={__name:"BookInfo",setup(p){const y=T(),s=v({}),r=v(""),i=v(!1),b=v(0),h=v([]),a=v(!1),o=v(""),d=v(0);W(()=>_(this,null,function*(){r.value=y.query.article_name;const l=`/api/method/library_management.api.book_info?article_name=${r.value}`;try{const n=yield(yield fetch(l,{credentials:"include",method:"POST",body:{article_name:r.value}})).json();s.value=n.message,b.value=parseInt(n.message.rating)}catch(e){console.error("Failed to fetch books: ",e)}try{const e=`/api/method/library_management.api.has_active_issue?book=${r.value}`,f=yield(yield fetch(e,{credentials:"include"})).json();i.value=f.message}catch(e){console.error("Failed to check the user have an active issue: ",e)}yield q()}));const B=D(()=>i.value?"opacity-0 cursor-not-allowed":"opacity-100");function j(){return _(this,null,function*(){const l=`/api/method/library_management.api.issue_book?book=${r.value}`;try{(yield(yield fetch(l,{credentials:"include"})).json()).message.success||alert("You already requested this book!")}catch(e){console.error("Failed to issue the book: ",e),i.value=!1}})}function F(){a.value=!a.value}function S(){a.value=!a.value,d.value=0,o.value=""}function N(){return _(this,null,function*(){try{const l=`/api/method/library_management.api.write_review?book=${r.value}&rating=${d.value}&review=${o.value}`,n=yield(yield fetch(l,{credentials:"include",method:"POST"})).json();n.message.success||alert(n.message.message),a.value=!a.value}catch(l){console.error("Failed to write review. ",l),alert("Failed to write review!"),a.value=!a.value}})}function q(){return _(this,null,function*(){try{const l=`/api/method/library_management.api.get_reviews?book=${r.value}`,n=yield(yield fetch(l,{credentials:"include",method:"POST"})).json();h.value=n.message}catch(l){console.error("Failed to fetch book reviews: ",l)}})}return(l,e)=>{const n=k("rate"),f=k("Button"),I=k("Card");return x(),C($,null,[u(L),t("div",Q,[e[11]||(e[11]=t("div",{class:"w-[1120px] my-8 mx-auto text-[24px] font-bold relative"},[t("div",{class:"absolute w-1 h-12 bg-[#118ab2] left-0"}),t("h1",{class:"text-4xl font-bold pl-5 pt-2"},"Book Info")],-1)),t("section",X,[t("div",Z,[t("img",{src:s.value.image,class:"w-[200px] h-[300px] object-contain rounded-[5px]",alt:"book image"},null,8,ee),t("p",te,c(s.value.author),1),u(n,{length:5,modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=w=>b.value=w),disabled:!0,readonly:!0,showcount:!0,class:"color-black text-center opacity-[100%]"},null,8,["modelValue"])]),t("div",se,[t("h1",ae,c(s.value.article_name),1),t("div",oe,[t("p",null,[e[4]||(e[4]=t("b",null,"Author: ",-1)),m(c(s.value.author),1)]),t("p",null,[e[5]||(e[5]=t("b",null,"Publisher: ",-1)),m(c(s.value.publisher),1)]),t("p",null,[e[6]||(e[6]=t("b",null,"ISBN: ",-1)),m(c(s.value.isbn),1)]),t("p",null,[e[7]||(e[7]=t("b",null,"Status: ",-1)),m(c(s.value.status),1)])]),e[10]||(e[10]=t("h1",{class:"text-[18px] font-medium"},"Description",-1)),t("p",null,c(s.value.description),1),i.value?R("",!0):(x(),V(f,{key:0,onClick:j,variant:"solid",class:M(["bg-[#1290b9] w-[90px] text-white my-10 rounded hover:bg-[#016475] transition",B.value])},{default:g(()=>[...e[8]||(e[8]=[m(" Issue ",-1)])]),_:1},8,["class"])),u(f,{onClick:F,variant:"solid",class:"bg-[#1290b9] text-white my-10 rounded hover:bg-[#016475] transition"},{default:g(()=>[...e[9]||(e[9]=[m(" Write Review ",-1)])]),_:1})])])]),t("section",le,[h.value.length>0?(x(!0),C($,{key:0},O(h.value,w=>(x(),V(K,{review:w},null,8,["review"]))),256)):R("",!0)]),u(A),a.value?(x(),C("div",ne,[t("div",re,[u(I,{title:"Write Review!",class:"w-[50%] bg-[#f7f4f0] z-10 px-12 py-10 rounded-xl shadow-lg"},{default:g(()=>[e[14]||(e[14]=t("h2",{class:"text-xl font-medium text-center mb-8"},"Write Review",-1)),t("form",{class:"flex flex-col space-y-5 w-full",onSubmit:e[3]||(e[3]=P(()=>{},["prevent"]))},[u(n,{length:5,modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=w=>d.value=w),showcount:!0,class:"text-center"},null,8,["modelValue"]),U(t("textarea",{required:"","onUpdate:modelValue":e[2]||(e[2]=w=>o.value=w),name:"review",placeholder:"Review...",class:"h-[200px]"},null,512),[[z,o.value]]),t("div",ie,[u(f,{variant:"solid",onClick:N,class:"bg-[#007C91] w-[45%] m-auto text-white py-2 rounded hover:bg-[#006273] transition"},{default:g(()=>[...e[12]||(e[12]=[m(" Write Review ",-1)])]),_:1}),u(f,{onClick:S,variant:"solid",class:"bg-[#007C91] w-[45%] m-auto text-white py-2 rounded hover:bg-[#006273] transition"},{default:g(()=>[...e[13]||(e[13]=[m(" Cancel ",-1)])]),_:1})])],32)]),_:1})])])):R("",!0)],64)}}};export{ve as default};
//# sourceMappingURL=BookInfo-B941lT1u.js.map

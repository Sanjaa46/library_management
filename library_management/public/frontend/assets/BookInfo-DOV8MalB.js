var _=(w,y,a)=>new Promise((l,i)=>{var h=n=>{try{o(a.next(n))}catch(d){i(d)}},b=n=>{try{o(a.throw(n))}catch(d){i(d)}},o=n=>n.done?l(n.value):Promise.resolve(n.value).then(h,b);o((a=a.apply(w,y)).next())});import{B as k,l as C,m as x,n as t,q as u,L as c,J as T,r as v,a as W,i as D,c as M,M as V,y as $,G as p,v as g,N as O,F as B,x as P,C as U,D as z,E}from"./index-BOLl13Oy.js";import{b as L,_ as A,a as G}from"./Footer-BjM0NJg-.js";const J={class:"w-full h-[70%] bg-black-overlay-30 rounded-[20px] mx-5 shadow-xl"},Y={class:"flex p-3"},H={class:"my-auto ml-3"},K={class:"w-full h-[20px] p-1"},Q={__name:"Reviews",props:{review:{type:Object,required:!0}},setup(w){return(y,a)=>{const l=k("rate");return x(),C("article",J,[t("div",Y,[a[1]||(a[1]=t("img",{src:L,alt:""},null,-1)),t("h1",H,c(w.review.library_member),1)]),u(l,{length:5,modelValue:w.review.rating,"onUpdate:modelValue":a[0]||(a[0]=i=>w.review.rating=i),disabled:!0,readonly:!0,class:""},null,8,["modelValue"]),t("p",K,c(w.review.review),1)])}}},X={class:""},Z={class:"flex w-[1120px] p-[30px] mx-auto my-10"},ee={class:"flex flex-col w-[20%] items-center justify-center"},te=["src"],se={class:"text-center mt-5"},ae={class:"w-[80%] ml-10"},oe={class:"text-[25px] font-medium"},le={class:"flex my-5 space-x-5 text-[15px]"},ne={class:"w-[1120px] h-[250px] flex m-auto"},re={key:0,class:"absolute w-screen top-0 h-full bg-black-overlay-300"},ie={class:"flex w-full h-full justify-center items-center"},ue={class:"w-full space-x-5 m-auto"},ve={__name:"BookInfo",setup(w){const y=T(),a=v({}),l=v(""),i=v(!1),h=v(0),b=v([]),o=v(!1),n=v(""),d=v(0);W(()=>_(this,null,function*(){l.value=y.query.article_name;const r=D("socket"),e=`/api/method/library_management.api.book_info?article_name=${l.value}`;try{const m=yield(yield fetch(e,{credentials:"include",method:"POST",body:{article_name:l.value}})).json();a.value=m.message,h.value=parseInt(m.message.rating)}catch(s){console.error("Failed to fetch books: ",s)}try{const s=`/api/method/library_management.api.has_active_issue?book=${l.value}`,R=yield(yield fetch(s,{credentials:"include"})).json();i.value=R.message}catch(s){console.error("Failed to check the user have an active issue: ",s)}yield I(),r.on("new_review",s=>{s.book===l.value&&b.value.unshift({library_member:s.library_member,rating:s.rating,review:s.review,name:s.name})})}));const j=M(()=>i.value?"opacity-0 cursor-not-allowed":"opacity-100");function F(){return _(this,null,function*(){const r=`/api/method/library_management.api.issue_book?book=${l.value}`;try{(yield(yield fetch(r,{credentials:"include"})).json()).message.success||alert("You already requested this book!")}catch(e){console.error("Failed to issue the book: ",e),i.value=!1}})}function S(){o.value=!o.value}function N(){o.value=!o.value,d.value=0,n.value=""}function q(){return _(this,null,function*(){try{const r=`/api/method/library_management.api.write_review?book=${l.value}&rating=${d.value}&review=${n.value}`,s=yield(yield fetch(r,{credentials:"include",method:"POST"})).json();s.message.success||alert(s.message.message),o.value=!o.value}catch(r){console.error("Failed to write review. ",r),alert("Failed to write review!"),o.value=!o.value}})}function I(){return _(this,null,function*(){try{const r=`/api/method/library_management.api.get_reviews?book=${l.value}`,s=yield(yield fetch(r,{credentials:"include",method:"POST"})).json();b.value=s.message}catch(r){console.error("Failed to fetch book reviews: ",r)}})}return(r,e)=>{const s=k("rate"),m=k("Button"),R=k("Card");return x(),C(B,null,[u(A),t("div",X,[e[11]||(e[11]=t("div",{class:"w-[1120px] my-8 mx-auto text-[24px] font-bold relative"},[t("div",{class:"absolute w-1 h-12 bg-[#118ab2] left-0"}),t("h1",{class:"text-4xl font-bold pl-5 pt-2"},"Book Info")],-1)),t("section",Z,[t("div",ee,[t("img",{src:a.value.image,class:"w-[200px] h-[300px] object-contain rounded-[5px]",alt:"book image"},null,8,te),t("p",se,c(a.value.author),1),u(s,{length:5,modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=f=>h.value=f),disabled:!0,readonly:!0,showcount:!0,class:"color-black text-center opacity-[100%]"},null,8,["modelValue"])]),t("div",ae,[t("h1",oe,c(a.value.article_name),1),t("div",le,[t("p",null,[e[4]||(e[4]=t("b",null,"Author: ",-1)),p(c(a.value.author),1)]),t("p",null,[e[5]||(e[5]=t("b",null,"Publisher: ",-1)),p(c(a.value.publisher),1)]),t("p",null,[e[6]||(e[6]=t("b",null,"ISBN: ",-1)),p(c(a.value.isbn),1)]),t("p",null,[e[7]||(e[7]=t("b",null,"Status: ",-1)),p(c(a.value.status),1)])]),e[10]||(e[10]=t("h1",{class:"text-[18px] font-medium"},"Description",-1)),t("p",null,c(a.value.description),1),i.value?V("",!0):(x(),$(m,{key:0,onClick:F,variant:"solid",class:O(["bg-[#1290b9] w-[90px] text-white my-10 rounded hover:bg-[#016475] transition",j.value])},{default:g(()=>[...e[8]||(e[8]=[p(" Issue ",-1)])]),_:1},8,["class"])),u(m,{onClick:S,variant:"solid",class:"bg-[#1290b9] text-white my-10 mx-5 rounded hover:bg-[#016475] transition"},{default:g(()=>[...e[9]||(e[9]=[p(" Write Review ",-1)])]),_:1})])])]),t("section",ne,[b.value.length>0?(x(!0),C(B,{key:0},P(b.value,f=>(x(),$(Q,{review:f},null,8,["review"]))),256)):V("",!0)]),u(G),o.value?(x(),C("div",re,[t("div",ie,[u(R,{title:"Write Review!",class:"w-[50%] bg-[#f7f4f0] z-10 px-12 py-10 rounded-xl shadow-lg"},{default:g(()=>[e[14]||(e[14]=t("h2",{class:"text-xl font-medium text-center mb-8"},"Write Review",-1)),t("form",{class:"flex flex-col space-y-5 w-full",onSubmit:e[3]||(e[3]=U(()=>{},["prevent"]))},[u(s,{length:5,modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=f=>d.value=f),showcount:!0,class:"text-center"},null,8,["modelValue"]),z(t("textarea",{required:"","onUpdate:modelValue":e[2]||(e[2]=f=>n.value=f),name:"review",placeholder:"Review...",class:"h-[200px]"},null,512),[[E,n.value]]),t("div",ue,[u(m,{variant:"solid",onClick:q,class:"bg-[#007C91] w-[45%] m-auto text-white py-2 rounded hover:bg-[#006273] transition"},{default:g(()=>[...e[12]||(e[12]=[p(" Write Review ",-1)])]),_:1}),u(m,{onClick:N,variant:"solid",class:"bg-[#007C91] w-[45%] m-auto text-white py-2 rounded hover:bg-[#006273] transition"},{default:g(()=>[...e[13]||(e[13]=[p(" Cancel ",-1)])]),_:1})])],32)]),_:1})])])):V("",!0)],64)}}};export{ve as default};
//# sourceMappingURL=BookInfo-DOV8MalB.js.map
